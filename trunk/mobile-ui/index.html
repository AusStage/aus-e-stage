<!doctype html>
<html>
    <head>
        <meta charset="UTF-8" />
        <title>Aus Stage</title>
        <style type="text/css" media="screen">@import "assets/jqtouch/jqtouch.min.css";</style>
        <style type="text/css" media="screen">@import "assets/jqtouch/themes/ausstage/theme.css";</style>
        <script src="assets/jqtouch/jquery.1.3.2.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="assets/jqtouch/jqtouch.min.js" type="application/x-javascript" charset="utf-8"></script>
          <script src="assets/jqtouch/extensions/jqt.location.js" type="application/x-javascript" charset="utf-8"></script>


        <script type="text/javascript" src="assets/javascript/chain-0.2.js" type="application/x-javascript" charset="utf-8"></script>


        <script type="text/javascript" charset="utf-8">
            var jQT = new $.jQTouch({
                icon: 'jqtouch.png',
                addGlossToIcon: false,
                startupScreen: 'jqt_startup.png',
                statusBar: 'black',
                preloadImages: [
                    'assets/jqtouch/themes/jqt/img/back_button.png',
                    'assets/jqtouch/themes/jqt/img/back_button_clicked.png',
                    'assets/jqtouch/themes/jqt/img/button_clicked.png',
                    'assets/jqtouch/themes/jqt/img/grayButton.png',
                    'assets/jqtouch/themes/jqt/img/whiteButton.png',
                    'assets/jqtouch//themes/jqt/img/loading.gif'
                    ]
            });
        
		
	
	
		//Our main document load 
		$(document).ready(function() {

 
	
	});

		 function setLocDisplay(text) {
					$('.LocInfo').empty().append(text);
					
                }
				
				
		function findLocation(){
		                
                // We pass "updateLocation" a callback function,
                // to run once we have the coordinates.
                // We also set it to a variable, so we can know
                // right away if it's working or not
                var lookup = jQT.updateLocation(function(coords){
                    if (coords) {
                        setLocDisplay('Latitude: ' + coords.latitude + '<br />Longitude: ' + coords.longitude);
                    } else {
                       setLocDisplay('Device not capable of geo-location.');
                    }
                });

                if (lookup) {
                    setDisplay('Looking up location&hellip;');
                }		
					
		}
		function getPerformanceData(performance) {
			
				  var host = $(location).attr('host');
				  
				  //now do the stuff to make the host names work 
				  if (host != 'http://beta.ausstage.edu.au')  { 
					  host = 'http://beta.ausstage.edu.au';
					  mydataType =  'jsonp';
				  } else {
					   mydataType =  'json';
				  }
				  
				//now build the url  
				var source =  host + '/mobile/feedback?task=initial&performance=' + performance  ;  //TODO code to see what server the system is running on and build this URL 
				
				window.console.log(source);
				
				$.ajax({
						type:   'GET',
						url: source, 
						dataType: mydataType,
						success: function (data) {

							populate(data,performance);
						},
						async: true 
					}); 			

		}; 
		
		/*
		* This is the main call that loads the json in to the correct D
		*
		**/
		function populate(data,performance){
			//alert("ye got here"); 
			//window.console.log(data);
			//$("#Add").item(data).chain();//load this data in the feedback 
			$("#feedback").items(data.feedback).chain();//load this data in the feedback 		
			$("#FeedbackDisplay").item(data).chain();//load this data in the feedback 	
			$("input.performance").val(performance);
			var CurrentDate = new Date();  
			$("input.CurrentDate").val(CurrentDate.toDateString());
			$("input.CurrentTime").val(CurrentDate.toTimeString());

			


								
		
		};
		
	
		
		
		function loadFeedbackForm() {
		
		  var element = (event.target.nodeName == "SPAN") ? event.target.parentNode : event.target;
		  var CurrentPerformance =   $(element).children("span.performance").text();
		  getPerformanceData(CurrentPerformance);

				
		}; 
		
		
		
		function loadFeedback() {
		
		  var element = (event.target.nodeName == "SPAN") ? event.target.parentNode : event.target;
		  var CurrentPerformance =   $(element).children("span.performance").text();
		  getPerformanceData(CurrentPerformance);

		}; 
		
		
		
		
		
        </script>
        <style type="text/css" media="screen">
            body.fullscreen #home .info {
                display: none;
            }
            #about {
                padding: 100px 10px 40px;
                text-shadow: rgba(255, 255, 255, 0.3) 0px -1px 0;
                font-size: 13px;
                text-align: center;
                background: #161618;
            }
            #about p {
                margin-bottom: 8px;
            }
            #about a {
                color: #fff;
                font-weight: bold;
                text-decoration: none;
            }
        </style>
    </head>
    <body>
       
 
         <div id="home" class="current">
            <div class="toolbar">
                <h1>AusStage</h1>
                <a class="button slideup" id="infoButton" href="#about">About</a>
            </div>
            
            <div class="info">
                <p>Intro</p>
            </div>
      	
            <ul class="rounded">
            
            <li class="arrow"><a href="#Near" onClick="findLocation()">Performances near you</a> <small class="counter">1</small></li> 
			<li class="arrow"><a href="#Search">Search</a> <small class="counter">2</small></li>
			<li class="arrow"><a href="#About">About</a><small class="counter">4</small></li>

            </ul>
        </div>


 <div id="Near">
            <div class="toolbar">
                <h1>Performances near you</h1>
                <a class="back" href="#">Home</a>
                <a class="button slideup" id="infoButton" href="#about">About</a>
            </div> 
         
  		<div class="LocInfo info">
                <p>Looking up location&hellip;</p>
            </div>
                     
        <ul class="rounded">
          <li class="arrow"><a href="#FeedbackDisplay"  onClick="loadFeedback(event)">Be Your Self <span class="performance">4</span></a> <small class="counter">1</small></li>		   
        </ul>              
      
</div>



 <div id="Add">
            <div class="toolbar">
                <h1 class="event"></h1>
                <a class="back" href="#">Home</a>
                <a class="button slideup" id="infoButton" href="#about">About</a>
            </div> 

          <form id="ajax_post" action="http://beta.ausstage.edu.au/mobile/feedback" method="GET" class="form">
        		<h3 class="question">Question</h3>
				<ul class="edit rounded">
                <li><input type="text" name="performance" class="performance" value=""></input></li>
            	<li><textarea placeholder="Textarea" ></textarea></li>
                    
               </ul>
            <a style="margin:0 10px;color:rgba(0,0,0,.9)" href="#" class="submit whiteButton">Submit</a>
        </form>
        
      
           
   
        
      
</div> 
      
          <div id="Search">
            <div class="toolbar">
                <h1>Search</h1>
                <a class="back" href="#">Home</a>
                                <a class="button slideup" id="infoButton" href="#about">About</a>

            </div>          
         </div> 
        
          <div id="About-Panel">
            <div class="toolbar">
                <h1>About</h1>
                <a class="back" href="#">Home</a>
               <a class="button slideup" id="infoButton" href="#about">About</a>

            </div>          
         </div>        
         
          <div id="about" class="selectable">
               	
                <!--TODO add some about information to here-->
                About this service. 
                
                <p><br /><br /><a href="#" class="grayButton goback">Close</a></p>
        </div>
   
     
                           
	 <div id="FeedbackDisplay">
            <div class="toolbar">
                <h1 class="event"></h1>
                <a class="back" href="#">Home</a>
               <a class="button slideup" id="infoButton" href="#about">About</a>

            </div>             
            
             <div class="info">
            
            <div class="organisation">organisation</div>
            <div class="venue">venue</div>
            <div class="date">date</div>
            </div>
            
           <span class="performance"></span>

             
         <form id="ajax_post" action="http://beta.ausstage.edu.au/mobile/feedback" method="GET" class="form">
        		<h3 class="question">Question</h3>
                
				<ul class="edit rounded">
                	<li><input type="text" name="type" class="type" value="web" ></input></li>
             		<li><input type="text" name="time" class="CurrentTime" value="" ></input></li>
               		<li><input type="text" name="date" class="CurrentDate" value="" ></input></li>
                	<li><input type="text" name="performance" class="performance" value="" ></input></li>
            		<li><textarea placeholder=""  name-"message"></textarea></li>
                    
               </ul>
            <a style="margin:0 10px;color:rgba(0,0,0,.9)" href="#" class="submit whiteButton">Submit</a>
        </form>
        
      
      
      
           
           <h3 class="question"></h3>

            <ul id="feedback">
                    <li><a href="#details"><span class="content"></span></a></li>
            </ul>
         
         
         
         </div>      
      
    </body>
</html>