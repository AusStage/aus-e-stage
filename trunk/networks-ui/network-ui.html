

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:v="urn:schemas-microsoft-com:vml" lang="en">
<head>
	<title>AusStage Navigating Networks Protovis Trial</title>
	<meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/> 
	<link rel="stylesheet" type="text/css" media="screen" href="assets/main-style.css"/>

    <!-- Protovis Files -->
    <script type="text/javascript" src="assets/javascript/libraries/protovis-r3.2.js"></script>

	<!-- jquery files --> 
	<script type="text/javascript" src="assets/javascript/libraries/jquery-1.4.2.min.js"></script>
	<script type="text/javascript" src="assets/javascript/libraries/jquery-ui-1.8.4.custom.min.js"></script>
	<script type="text/javascript" src="assets/javascript/libraries/jquery.form-2.4.3.js"></script>
	<script type="text/javascript" src="assets/javascript/libraries/jquery.validate-1.7.min.js"></script>
	<script type="text/javascript" src="assets/javascript/libraries/jquery.selectboxes-2.2.4.min.js"></script>
	<script type="text/javascript" src="assets/javascript/libraries/jquery.tipsy-1.0.0a.js"></script>
    <script type="text/javascript" src="assets/javascript/libraries/selectToUISlider.jQuery.js"></script>    

	<!-- helper files -->
    <script type="text/javascript" src="assets/javascript/network-ui.js"></script>


	<link rel="stylesheet" href="assets/jquery-ui/jquery-ui-1.8.4.custom.css" type="text/css" />
	<link rel="Stylesheet" href="assets/jquery-ui/ui.slider.extras.css" type="text/css" />
         
    <!-- Input file. JSON format. -->
   <!-- <script type="text/javascript" src="data/smlNetworkEx.js"></script>-->

			<script type="text/javascript+protovis">
var vis;
function loadNetwork(vis, contributors, targetDiv){
	if (contributors != null){
    	///////////////////////////////////////////////////////	
    	// define variables for colour options.
    	
    		var bgColour = "white";
    		var activeLinkOpaqueStroke = "rgba(47,79,79,1)";
    		var activeLinkStroke = "rgba(47,79,79,.5)";
    		var inactiveLinkStroke = "rgba(102,139,139,.2)";
    		var mouseoverLinkStroke = "rgba(220,20,60,1)";
    		var linkColourHolder;
    		
    		var relatedNodeFill = "rgba(0,0,255,0.7)";
    		var relatedNodeStroke = "rgba(0,0,255,0.9)";
    		
    		var inactiveNodeFill = "rgba(128,128,128,0.5)";
    		var inactiveNodeStroke = "rgba(128,128,128,0.5)";
    		
    		var focusNodeFill =	"blue";
    		var focusNodeStroke = "red";
			 
			var w = 796,
    		h = 600;

    		
    	////////////////////////////////////////////
    	// define nodeFocus. True if focus is on nodes. False if on edges.
    		var nodeFocus = true;    	
    	///////////////////////////////////////////
    	// define mouseOverEdge. True if mouse is over an edge.
    		var mouseOver = false;
		
		//////////////////////////////////////////
		// store target and source node for edge focus operations
    		var targetNodeSelect;
    		var sourceNodeSelect;
    	
    	////////////////////////////////////////////////////////
    	// store seperate target and source node info for mouse over operations.
    		var targetNodeMO;
    		var sourceNodeMO;	
    		
    	////////////////////////////////////////////////////////	
		// construct a 3d array of nodes and their neighbors
			var nodeNeighbors = loadNodeNeighbors(contributors);

		///////////////////////////////////////////////////////
		//fix the central node in position. This is a fix to help the stability of the system
			contributors.nodes[0].fix = new pv.Vector(w/2,h/2);

		///////////////////////////////////////////////////////
		// keep a record of the currently selected node. Assuming, on load that the currently selected node is the first in the array.
			var activeNode = 0; 
			var nodeLinkDegree = contributors.nodes[0].collaborations;

		///////////////////////////////////////////////////////
		// new panel. 
		// Essentially the base element 
		// for all protovis visualisation
			vis = new pv.Panel().canvas(targetDiv)
			    .width(w)
			    .height(h)
			    .fillStyle(bgColour)
			    .event("mousedown", pv.Behavior.pan())
			    .event("mousewheel", pv.Behavior.zoom());

		///////////////////////////////////////////////////////
		//add a force layout to the Panel. 
			var force = vis.add(pv.Layout.Force)
			    .nodes(contributors.nodes)
			    .links(contributors.edges)
			    .bound(true)
			    .dragConstant(0.05)
			    .springConstant(0.05)
 			    .iterations(500)
			    .transform(pv.Transform.identity.scale(3).translate(-w/3,-h/3)) 

				;

		/////////////////////////////////////////////////////////
		//add the edges
  		   force.link.add(pv.Line) 
			    .strokeStyle(function(d, p) mouseOver && p.targetNode.index == targetNodeMO && p.sourceNode.index == sourceNodeMO ? mouseoverLinkStroke :
			    								 nodeFocus ? 
			    									p.sourceNode.index == activeNode ?
			    									 activeLinkStroke : 
		    									p.targetNode.index == activeNode ? activeLinkStroke : inactiveLinkStroke : 
		    								p.targetNode.index == targetNodeSelect && p.sourceNode.index == sourceNodeSelect ? activeLinkOpaqueStroke : inactiveLinkStroke
		    				 )
		    				 
	//	    	.event("mouseover", function(d, p) {targetNodeMO = p.targetNode.index;
	//		    									sourceNodeMO = p.sourceNode.index;
	//		    									mouseOver = true;
	//		    									return vis;
	//	    										})
		    										
	//	    	.event("mouseout", function(d,p) {mouseOver = false;
	//	    									  targetNodeMO = -1;
	//	    									  sourceNodeMO = -1;
	//	    									  return vis;
	//	    									  })

			    .event("click", function(d, p) {updateInfoWindowEdge(p);
			    								targetNodeSelect = p.targetNode.index;
			    								sourceNodeSelect = p.sourceNode.index;
			    								targetNodeMO = -1;
			    								sourceNodeMO = -1;
			    								nodeFocus=false;
			    								vis.render();})
			;
			
		//add the nodes
			force.node.add(pv.Dot)
			    .size(function(d) (d.linkDegree + 1) * Math.pow(this.scale, -1.5))
			    .fillStyle(function() nodeFocus ? 
			    					  	activeNode == this.index ? focusNodeFill : 
			    							contains(nodeNeighbors[activeNode], this.index) ? relatedNodeFill :inactiveNodeFill : 
			    						 targetNodeSelect == this.index || sourceNodeSelect == this.index ? focusNodeFill : inactiveNodeFill)

//mouseover functionality removed. can be added to the function below.
//mouseOver && this.index == targetNodeMO || this.index == sourceNodeMO ? mouseoverLink : 

			    .strokeStyle(function() 
			    						nodeFocus ? 
			    							activeNode == this.index ? focusNodeStroke : 
			    								contains(nodeNeighbors[activeNode], this.index) ? relatedNodeStroke:inactiveNodeStroke:
			    							targetNodeSelect == this.index || sourceNodeSelect == this.index ? focusNodeStroke : inactiveNodeStroke)

			    .lineWidth(2)
			  
	 		  	.event("mouseover", function(d) {targetNodeMO = d.index;
		    									mouseOver = true;
		    									return vis;})
		    	.event("mouseout", function() {mouseOver = false;
		    								   targetNodeMO = -1;
											   return vis;})
			    .event("mousedown", pv.Behavior.drag())
			    .event("drag", force)
			    .event("click", function(d) { nodeLinkDegree = d.linkDegree;
    										  activeNode = this.index;
    										  nodeFocus = true;
    										  updateInfoWindow(activeNode, contributors);
    										  return vis;})
    			.event("dblclick", function(d) findAndDisplayContributorNetwork(contributors.nodes[this.index].id))
    			.anchor("top").add(pv.Label).text(function(d) d.nodeName)
    										.font("9pt sans-serif")
											.textStyle(	function() nodeFocus ? 
			    													activeNode == this.index ? focusNodeStroke : 
					    											contains(nodeNeighbors[activeNode], this.index) ? relatedNodeStroke:inactiveNodeStroke:
									    							targetNodeSelect == this.index || sourceNodeSelect == this.index ? focusNodeStroke : inactiveNodeStroke)
    										.textShadow("0.1em 0.1em 0.1em #333")
							    			.visible(function() mouseOver && this.index == targetNodeMO || this.index == sourceNodeMO ? true :
							    			     				nodeFocus ? activeNode == this.index?true:false:
							    								targetNodeSelect == this.index || sourceNodeSelect == this.index ? true : false)
    			;


			vis.render();
		
			}			
}
					
    </script>

    
</head>

<body>
<div id="wrap">
	<div id="header"><h1>AusStage Navigating Networks Protovis Trial</h1></div>
	<div id="nav">
	</div>
	<!-- Include the sidebar -->
	

<div id="sidebar">

	<ul>
		<li><a id="contName" href=""></a></li>
		<li id="contFunct"></li>
		<li id="degCon"></li>
	</ul>

	<ul>
		<li><a id="collab1" href=""></a></li>
		<li><a id="collab2" href=""></a></li>
		<li id="noOfCollab"></li>
		<li id="eventRange"></li>
	</ul>

	
	<ul>
		<li id="networkTitle"></li>
		<li id="nodeCount"></li>
		<li id="edgeCount"></li>
		<li id="eventCount"></li>
		<li id="diameter"></li>
	</ul>
	
</div>

	<div id="main">
	
		<div id="load_network_form">
		  <form name="search" action="">
		    <fieldset>
		      <label for="id" id="id_label">Contributor Id</label>
		      <input type="text" name="id" id="id" size="30" value="" class="text-input" title="Enter the Contributor ID. Note: if you do not know the ID, leave this field empty and click the lookup button to do a search"/>

		      <label for="name" id="name_label">Name</label>
		      <input type="text" readonly="readonly" name="name" id="name" size="40" value="" class="text-input" />
      
		      <input type="submit" name="submit" class="button" id="lookup_btn" value="Lookup" />
		      <input type="submit" name="submit" class="button" id="network_btn" value="View Network" />	      
		      <p align="centre" id="networkCentre"></p>
		    </fieldset>

		  </form>
		</div>

		

		<div id="protovis">

		</div>

		<script type="text/javascript">		
			$('select#startDate, select#endDate').selectToUISlider({
				labels: 6
			});		
		</script>
		
		<div id="date_range_div">
		<fieldset>
			<form name="dateRanges">
				<label for="startDate">From:</label>
				<select name="startDate" id="startDate">
				</select>
			
				<label for="endDate">To:</label>
				<select name="endDate" id="endDate">
				</select>
			</form>
		</fieldset>
		</div>
</div>

<!--dialogue for loading the network. -->
<div id="network_loading" style="display: none" title="Loading Network. Please wait...">
	<img src="assets/images/ajax-loader.gif" width="220" height="19" alt=" "/>
</div>

	<!-- Search form div -->
<div id="search_div" title="Contributor Search">
	<p>Enter a contributor name, or part of their name, and click the search button</p>
	<form name="search" action="">			
		<table class="formTable">
			<tbody>
				<tr>
				<th scope="row">
				<label id="name_label" for="name">Contributor Name: </label>
				</th>
				<td>
				<input type="text" size="40" id="query" name="query" title="Enter the contributor name, or part of their name, and click the search button"/>
				</td>
				</tr>
			</tbody>
		</table>
	</form>
		<table id="search_results" class="searchResults">
			<thead>
				<tr>
					<th>Contributor Name</th>
					<th>Functions</th>
					<th>Collaborations</th>
					<th>&nbsp;</th>
				</tr>
			</thead>
			<tbody id="search_results_body">
			</tbody>
		</table>
		<div id="search_waiting">
			<p style="text-align: center;">
				<img src="assets/images/ajax-loader.gif" width="220" height="19" alt=" "/>
				<br/>Loading Search Results...
			</p>
		</div>
		<div id="error_message">
		</div>
		<p>
		 <strong>Note: </strong>Search results are limited to 5 records. If you do not see the contributor that you expected, please refine your search. Alternatively the contributor may not be part of the Navigating Networks Dataset at this time.
		</p>		
</div>


<div id="footer">

</div>

</div>
</body>
</html>
