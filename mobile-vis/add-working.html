<!doctype html>
<html>
    <head>
        <meta charset="UTF-8" />
        <title>Aus-e-Stage Researching Audiences Service</title>

        <link rel="stylesheet" href="assets/main-style.css"/>
	<link rel="stylesheet" href="assets/common-web-assets/ausstage-colours.css"/>
	<link rel="stylesheet" href="assets/common-web-assets/ausstage-background-colours.css"/>
	<link rel="stylesheet" href="assets/common-web-assets/jquery-ui-1.8.6.custom.css"/>

        <link rel="stylesheet" href="assets/vis.css"/>

	<!-- libraries -->
	<script type="text/javascript" src="assets/javascript/libraries/jquery-1.5.min.js"></script>
	<script type="text/javascript" src="assets/javascript/libraries/jquery-ui-1.8.6.custom.min.js"></script>
	<script type="text/javascript" src="assets/javascript/libraries/jquery.ajaxmanager-3.0.9.js"></script>
	<script type="text/javascript" src="assets/javascript/libraries/jquery.form-2.4.3.js"></script>

        <script type="text/javascript" src="assets/javascript/chain-0.2.js" type="application/x-javascript" charset="utf-8"></script>

        <!-- custom code for this page  -->
        <script src="assets/javascript/searchModel.js"></script>
        <script src="assets/javascript/errorController.js"></script>
        <script src="assets/javascript/visControllerSearch.js"></script>
        <script src="assets/javascript/visControllerChooseView.js"></script>

        <script type="text/javascript" charset="utf-8">
         
			
             //Globals
              var gCurrentPerformance = 0 ;
			
                  /**
                  * The Jquery document ready. Acts like the main.
                  *  See if there is any url varialbes and
                  *  the user directly to that feedback if that is the case.
                  *  If there is now URL variable then the current peformance list is loaded in on the homepage
                  */
						   
		   $(document).ready(function() {			
		
	                CurrentPerformances = getUrlVars();
                        gCurrentPerformance  =  CurrentPerformances[0];//only load the first performance 
                        
                        getPerformanceData(gCurrentPerformance);

			//window.console.log(gCurrentPerformance);
			 
			
		});
		
		/**
		* Takes data objects and converts it to yyyy-mm-dd string  
		* @param  date  is he data object that is going be converted  
		* @returns returns the date in yyyy-mm-dd form  
		*/	
			
		function reFormatDatetoYYYYMMDD (date){
			
			var year = date.getFullYear();  
			var month = date.getMonth() +1;//correct for Jan being 00
			//Reformat the month if it's be 10   
			if(month < 10) {  
				var month  =  '0' + month;
				};

			
			var day = date.getDate(); 
			//Reformat the  day if it's less than 10  
			if(day < 10) {  
				var day =  '0' + day;
			};
			
			var dataString =  '' + year + '-' + month + '-' + day;
			return dataString; 
		}


		
		/*
		* Get the URL var and takes the user to the current form for that performance.    
		* 
		*/ 			
		
		function getUrlVars()
		{

				//Slice the url varibles up
				var vars = [], hash;
				var hashes = window.location.href.slice(window.location.href.indexOf('?') + 1).split('&');

				for(var i = 0; i < hashes.length; i++)
				{
					hash = hashes[i].split('=');
					vars.push(hash[0]);
					vars[hash[0]] = hash[1];
				}

				var performances = new Array();

				if(vars['performance'].indexOf("+") != -1) {
					// yes we have more than performances
					//window.console.log('got muliple performances');
					//split that using the + sign
					performances = vars['performance'].split('+');

				} else {
					 performances[0] = vars['performance']
				};

				return performances;
                }
		
		/**
		* Called form the submit button.  Reads the information form the current form submits and the reloads the page. 
		*/
		
		function submitForm(){
			
			  //window.console.log("about to submit the form");
			   
				$('.submit').html('Loading');
				//figure out which server we one 
				
				host = buildHost();
			    var mydataType = getDataType(); 
			   
		 		//var gCurrentPerformance = $('.class')	
							    
 				  	
				//Get the date and time; 
				/* OLD material
				var CurrentDate = new Date(); 
				var currentTime =  CurrentDate.toTimeString();
				//Change the format of the date so that works with API
				currentTime =  currentTime.replace(" (EST)", "", "gi");  
				currentTime =  currentTime.replace("GMT", "", "gi");  
				currentTime =  currentTime.replace(" (CST)", "", "gi");  
				*/
				//bulld the  
				
				// get the message form the form
				
				var message =  $('[name=message]').val();
				
				//get the current peformance from the form. 
				gCurrentPerformance = $(".CurrentPerformance").html(); 

				
				 var params = {
					 
					 type:'mobile-web',
					// time:currentTime,
					// date:CurrentDate.toDateString(),
					 performance:gCurrentPerformance,
					 message:message	 
				 
				 };
				 var values = jQuery.param(params);//encode thos
				
				var source =  host + '/mobile/gatherer?' +  values;

				//window.console.log(source);
				
				//remove what is currently is being shown 
				$(".feedback").items('remove').chain();//load this data in the feedback
				$(".feedbackForm").items('remove').chain();//load this data in the feedback 
				
				$.ajax({
						type:   'GET',
						url: source, 
						cache: false,
						dataType: mydataType,
						success: function (data) {
							////window.console.log(data);

							//$(".feedback").items('remove').chain();//load this data in the feedback
							
							//$(".feedback").items('replace',data.feedback.reverse()).chain();//load this data in the feedback
							//$("#FeedbackDisplay").item(data).chain();//load this data in the feedback 
							
							$(".feedbackForm").empty();
							
							 data.feedback.reverse();
							// add the list of feedback
							for(var i = 0; i < data.feedback.length; i++) {
								item = data.feedback[i];	
								////window.console.log(item.content);

								$(".feedbackForm").append('<li>' +

											'<div class="content">' + item.content + '</div>' +
											'<span class="feedback-about">' + 
						   
												'<span class="date">' + item.date +' </span>' +
												'<span class="time">' + item.time +' </span>' +
												'<span class="type">' + item.type +' </span>' +
                       						
											'</span>'
								+'</li>');
								
							}
				
				
							
							$('.submit').html('Submit');


						},
						error:function (xhr, ajaxOptions, thrownError){
                                                alert(xhr.status);
                                                alert(thrownError);
				

                	},
					
						async: true 
					});	
		}
		

	
	
		/*
		* Get the current host name from the location string   
		* @returns host as a string    
		*/ 
		
		function buildHost() {
			
			 var host = $(location).attr('host');
			  if (host != 'http://beta.ausstage.edu.au')  { 
					  host = 'http://beta.ausstage.edu.au';				  
			  }
			  return host;
				  
			
		}
		/*
		* See if the data types should be jsonp or json, it does his based on host. The only server that josn will work on is http://beta.ausstage.edu.au   
		* 
		* @returns data as a string, it will be json or json.     
		*/ 
		
		function getDataType() {
			 	var host = $(location).attr('host');
			   if (host != 'http://beta.ausstage.edu.au')  { 
					  return 'jsonp';
				  } else {
					  return 'json';
				  }
		
		}
		
		/*
		* Load the peformance data and last feedback into the actual form.    
		* 
		* @param  gCurrentPerformance the current performane we are working thi   
		*/ 
				  
		function getPerformanceData(gCurrentPerformance) {
				
			
					
				//change the Interfaace to show that is loading 
				
				$('.submit').html('Loading');
				
				//find out what server we are running on make sure the data type is right 
				host = buildHost();
			 	mydataType = getDataType(); 
				
				//alert(gCurrentPerformance);
				
				//now build the url/calll  for API 
				
				var source =  host + '/mobile/feedback?task=initial&performance=' + gCurrentPerformance  ;  //TODO code to see what server the system is running on and build this URL 
				
				//window.console.log(source);
				
				//The important bit more  
				$.ajax({
						type:   'GET',
						url: source, 
						dataType: 'jsonp',
						cache: false,
						success: function (data) {
							
								$("#FeedbackDisplayWithForm").item(data).chain();//load this data in the feedback 	populate(data);
								//make sure the current peformance in the html so can pick it up later.  
								$(".CurrentPerformance").html(gCurrentPerformance);
								
							//$(".feedback").items('replace',data.feedback).chain();//load this data in the feedback
							
							$(".feedbackForm").empty();
							
							 data.feedback.reverse();
							// add the list of feedback
							for(var i = 0; i < data.feedback.length; i++) {
								item = data.feedback[i];	
								////window.console.log(item.content);

								$(".feedbackForm").append('<li>' +

											'<div class="content">' + item.content + '</div>' +
											'<span class="feedback-about">' + 
						   
												'<span class="date">' + item.date +' </span>' +
												'<span class="time">' + item.time +' </span>' +
												'<span class="type">' + item.type +' </span>' +
                       						
											'</span>'
								+'</li>');
							}
				
				
							$('.submit').html('Submit');
							////window.console.log(data);
						},
					
					error:function (xhr, ajaxOptions, thrownError){
                                                //alert(xhr.status);
                                                //alert(thrownError);


                	},
				
				
					async: true 
					}); 			

		}; 
		
	
		

        </script>
        
    </head>

    <body >

<div class="wrapper">
	<div class="header b-187"><h1>Aus-e-Stage Service Development</h1></div>
	<div class="sidebar b-186 f-184">
		<!-- side bar content -->
		<div class="mainMenu">
			<h2>Main Menu</h2>
			<ul>
				<li><a href="http://www.ausstage.edu.au" title="AusStage Homepage">AusStage Website</a></li>

			</ul>
		</div>
	</div>
	<div class="main b-184 f-187">


  
            
         <div id="FeedbackDisplayWithForm">
                     
          
             <div class="info">
             <div class="event"></div>
            <div class="organisation">Loading</div>
            <span class="venue"></span>
            <span class="date"></span>
            </div>
            
           <span class="CurrentPerformance"></span>

             
         <form id="submit-feedback" action="" method="GET" class="form">
        		<h3 class="question">Question</h3>
				<ul class="rounded" >
            		<li class="form"><textarea placeholder="" name="message"></textarea></li>
               </ul>

 			<a  href="#" onClick="submitForm()" class="greenButton submit">Submit</a>
         </form>
        	
            
     
            <ul class="feedbackForm">
                    <li>
                    
                        <div class="content">Loading .... </div>
                        <span class="feedback-about">
                            <span class="date"></span>
                            <span class="time"></span>
                            . Via <span class="type"></span>
                        </span>
                    
                    </li>
            </ul>
                  
         </div>  
         

      
          <div id="About">


              <div id="about">
            <p>AusStage documents the performing arts in Australia. Future generations, researchers and contemporary audiences can log on to AusStage, search and retrieve information about, company and performer histories, maps, tours and, links to related material, all at <a href="http://www.ausstage.edu.au.">www.ausstage.edu.au.</a> For free.</p>
            <p>AusStage now provides audiences with the chance to contribute to this important cultural record by letting companies know what you thought of the production you're seeing right now. You can use your phone to send a text message or, if you're a tweeter you can use Twitter or, if you'd like to jump on the web and use the mobile web site you could do that too.</p>
            <p>Don't worry – AusStage doesn't record or store ANY IDENTIFYING INFORMATION about you. In fact, it doesn't even record the phone number or Twitter account you've used to respond so there's no way that they, or the company whose show you're talking about, can tell who you are, let alone contact you.</p>
            <p>Recording audience responses to performance is important for companies, researchers, performers and you. It fleshes out our cultural history and will provide future generations with a richer and fuller understanding of what we did, saw, liked and didn't like.</p>
            <p>This project is being led by Flinders University alongside the companies and artists who you are seeing tonight. It has been funded by the National e-Research Architecture Taskforce (NeAT).</p>
            <p>If you do decide that you'd like to have your say about what you see tonight your standard costs for SMS and network access apply. If you are under 18 years, you must ask for your parent/guardian's permission to participate in this study. As mentioned your participation is voluntary, you will NOT be identified in any results and your response will be stored confidentially (however,please note that sending information via mobile devices is inherently insecure).</p>
            <p>This research project has been approved by the Flinders University Social and Behavioural Research Ethics Committee (Project Number 4892). For more information regarding ethical approval of the project the Executive Officer of the Committee can be contacted on human.researchethics@flinders.edu.au.</p>
            <p>Any enquiries you may have concerning this project should be directed to Jonathan Bollen on 8201 5874 or by email to <a href="mailto:jonathan.bollen@flinders.edu.au">jonathan.bollen@flinders.edu.au</a></p>

                </div>



         </div> 	<!-- always at the bottom of the content -->
	<div class="push"></div>
</div>
<!-- include the Google Analytics code -->


<script type="text/javascript"> var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www."); document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E")); </script> <script type="text/javascript"> try { var pageTracker = _gat._getTracker("UA-10089663-2"); pageTracker._trackPageview(); } catch(err) {} </script>	</body>
</body>
</html>