#summary How to build overlays using ABS Data

<h1>!AbsDataFix - Building Map Overlays using ABS Data</h1>

The AbsDataFix application has been designed to provide a flexible framework for the manipulation of data sourced from the [http://www.abs.gov.au Australian Bureau of Statistics (ABS)] on the 2006 census. 

The data is manipulated in a variety of different ways to build overlays for use with [http://earth.google.com Google Earth] and other GIS enabled systems. Datasets are also constructed so that the [http://beta.ausstage.edu.au/mapping/ AusStage Mapping Service] can be used to dynamically populate the infoWindows in each overlay.

Outlined below are the steps necessary to use the AbsDataFix application to prepare a dataset sourced from the ABS using the SourcingAbsData procedure.

_Note 1: This procedure assumes that you are familiar with executing commands in a command line environment such as a terminal or command prompt window_

_Note 2: Ensure that all file and directory names do not include spaces_

<wiki:toc max_depth="2" />

= Step 1. Prepare your System =
 # Ensure that you have the latest version of [http://java.com Java] installed and properly configured on your system. The AbsDataFix application was written using Java version 1.6.
 # To assist in following these procedures it is recommended that you create a directory structure that starts with an *abs-data-fix* directory and has the following child directories
  # *bin* for storing the executable
  # *input* for storing the input files
  # *output* for storing the output files
  # *repository* for storing finalised files

= Step 2. Download and install the !AbsDataFix application =
 # Enter the following URL into the address bar of your browser http://code.google.com/p/aus-e-stage/
 # Download the !AbsDataFix-#.zip file listed under the *Featured Downloads* heading where # is the version number
 # Extract the contents of the archive and and copy them into the *bin* directory created in step 1

= Step 3. Building First Stage XML File = 
 # Choose one of the following steps to create the required dataset

== Step 3a. Build an Age by Sex Dataset ==
 # Copy the file downloaded at the end of the SourcingAbsData procedure into the *input* directory 
 # Ensure the file name does not contain any spaces and is all lower case
 # Open a terminal window / command prompt
 # Change directory to the *bin* directory 
 # Execute the following command where:
   # input-file: is the source data copied to the input directory in step 3a.1
   # output-file: is the name of the output XML file to create _Note: Specify the *output* directory as part of the path_
   {{{java -jar AbsDataFix.jar -fixtype agebysex -input input-file -output output-file}}}
 # If an error occurs adjust the parameters and try again
 # Take note of the file that was successfully created
 # Copy the XML file to the *repository* directory
 # Rename the file as follows where:
   # state-abbr: is the state abbreviation for example qld, nsw, sa etc. 
   {{{state-abbr-age-by-sex.xml}}}
 
= Step 4. Start a Collection District Dataset =
Collection District Dataset is an XML based file that is used for further processing and for use by the !AusStage Mapping Service for the population of infoWindows in Google Earth.

This step will only need to be undertaken once for each state using the Age by Sex Dataset created in step 3a.

 # Copy the XML file created in step 3a into the *input* directory
 # If necessary, open a terminal window / command prompt
 # If necessary, change directory to the *bin* directory 
 # Execute the following command where:
   # input-file: is the file copied to the input directory in step 4.1
   # output-file: is the name of the output XML file to create _Note: Specify the *output* directory as part of the path_
   {{{java -jar AbsDataFix.jar -fixtype databuilder -input input-file -output output-file}}}
 # If an error occurs adjust the parameters and try again
 # Take note of the file that was successfully created

= Step 5. Append additional information to the Collection District Dataset =

The Collection District Dataset requires additional information such as the Statistical Local Area and Local Government Area names. The easiest source of data to use for this step is the MapInfo files available from the [http://www.abs.gov.au/AUSSTATS/abs@.nsf/DetailsPage/1259.0.30.0022006 ABS website]

This step will only need to be undertaken once for each state using the Collection District Dataset created in step 4.

== Step 5.a Download the MapInfo File for the state currently being processed ==

 # Download the Zip file containing the MapInfo data for the state that is currently being worked on
 # Extract the files contained in the Zip File
 # Copy the extracted MID file into the *input* directory

== Step 5.b Use the MapInfo data to complete the Collection District Dataset == 

 # Copy the XML file created in step 4 to the *input* directory
 # If necessary, open a terminal window / command prompt
 # If necessary, change directory to the *bin* directory 
 # Execute the following command where:
   # input-file: is the file copied to the input directory in step 5.b.1
   # code-file: is the file copied into the *input* directory in step 5a.
   # output-file: is the name of the output XML file to create _Note: Specify the *output* directory as part of the path_
   {{{java -jar AbsDataFix.jar -fixtype appendcdinfo -input input-file -output output-file -codes code-file}}}
 # If an error occurs adjust the parameters and try again
 # Take note of the file that was successfully created

== Step 5.c Store the completed Collection District Dataset ==
 
 # Copy the XML file created in step 5.b to the *repository* directory
 # Rename the file as follows where:
   # state-abbr: is the state abbreviation for example qld, nsw, sa etc. 
   {{{abs-data-state-abbr.xml}}}

This file will form the basis for the Collection District Dataset that will be used by the AusStage Mapping Service to populate infoWindows and other web pages

= Step 6. Append the Dataset to the Collection District Dataset =

The ABS provides a variety of datasets that we will be making use of to construct overlays. Each new type of dataset will need to be appended to the Collection District Dataset file so that infoWindows and other parts of the Mapping Service can be maintained.

The AbsDataFix application does not undertake this task currently, once the second dataset has been decided upon the application will be amended.

= Step 7. Prepare the KML files ==

The MapInfo files provided by the ABS need to be converted into KML so that they can be used with applications such as Google Earth. Details of the way in which this conversion is achieved is available on the MapInfoToKML page. 

Once the conversion is complete the KML files are prepared for further processing specific to the AbsDataFix application. This step undertakes these changes and will only need to be undertaken once for each base KML file.

 # Copy the KML file into the *input* directory
 # If necessary, open a terminal window / command prompt
 # If necessary, change directory to the *bin* directory 
 # Execute the following command where:
   # input-file: is the file copied to the input directory in step 7.1
   # output-file: is the name of the output XML file to create _Note: Specify the *output* directory as part of the path_
   {{{java -jar AbsDataFix.jar -fixtype prepkml -input input-file -output output-file}}}
   <br/>_Note: This may take some time to complete_
 # If an error occurs adjust the parameters and try again
 # Take note of the file that was successfully created
 # Copy this file into the *repository* directory and rename it as follows where:
   # state-abbr: is the state abbreviation for example qld, nsw, sa etc. 
   {{{state-abbr-abs-base.kml}}}

= Step 8. Compile an overlay = 
Combining a prepared KML file with one of the [AbsDataFix##Step_3._Building_First_Stage_XML_File First Stage XML Files] will produce the finalised overlay for that dataset.

== Step 8a. Building an Age By Sex Overlay ==
 # Copy the base KML file, as created in step 7, for the required state from the *repository* directory to the *input* directory
 # Copy the Age By Sex dataset, as created in step 3a from the *repository* directory to the *input* directory
 # If necessary, open a terminal window / command prompt
 # If necessary, change directory to the *bin* directory 
 # Execute the following command where:
   # input-file: is the file copied to the input directory in step 8a.1
   # code-file: is the file copied into the *input* directory in step 8a.2
   # data-set: is one of the following options
     * male: male ages
     * female: female ages
     * total: total population ages
   # output-file: is the name of the output XML file to create _Note: Specify the *output* directory as part of the path_
   {{{java -jar AbsDataFix.jar -fixtype mapagebysex -input input-file -output output-file -codes code-file -dataset data-set}}}
   <br/>_Note: This may take some time to complete_
 # If an error occurs adjust the parameters and try again
 # Take note of the file that was successfully created
 # Copy this file into the *repository* directory and rename it as follows where:
   # state-abbr: is the state abbreviation for example qld, nsw, sa etc.
   # dataset: is the dataset used in step 8a.5 
   {{{state-abbr-abs-dataset-age-by-sex.kml}}}



 