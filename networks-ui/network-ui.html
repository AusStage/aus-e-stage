

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:v="urn:schemas-microsoft-com:vml" lang="en">
<head>
	<title>AusStage Navigating Networks Protovis Trial</title>
	<meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/> 
	<link rel="stylesheet" type="text/css" media="screen" href="assets/main-style.css"/>

	<!-- helper files -->
    <script type="text/javascript" src="assets/javascript/network-ui.js"></script>


    <!-- Protovis Files -->
    <script type="text/javascript" src="assets/javascript/libraries/protovis-r3.2.js"></script>

	<!-- jquery files for slider -->      
    <script type="text/javascript" src="assets/javascript/libraries/jquery-1.4.2.min.js"></script>
    <script type="text/javascript" src="assets/javascript/libraries/jquery-ui-1.8.4.custom.min.js"></script>
    <script type="text/javascript" src="assets/javascript/libraries/selectToUISlider.jQuery.js"></script>    

	<link rel="stylesheet" href="assets/jquery-ui/jquery-ui-1.8.4.custom.css" type="text/css" />
	<link rel="Stylesheet" href="assets/jquery-ui/ui.slider.extras.css" type="text/css" />
    
        
    <!-- Input file. JSON format. -->
    <script type="text/javascript" src="../data/smlNetwork.js"></script>

    
</head>

<body onload="displayAllInfo(0)"; >
<div id="wrap">
	<div id="header"><h1>AusStage Navigating Networks Protovis Trial</h1></div>
	<div id="nav">
	</div>
	<!-- Include the sidebar -->
	

<div id="sidebar">
	<ul>
		<li><a id="contName" href=""></a></li>
		<li id="eventRange"></li>
		<li id="contFunct"></li>
		<li id="degCon"></li>
	</ul>

	<ul>
		<li><a id="collab1" href=""></a></li>
		<li><a id="collab2" href=""></a></li>
		<li id="noOfCollab"></li>
	</ul>

	
	<ul>
		<li><h3>Network Properties</h3></li>
		<li id="nodeCount"></li>
		<li id="edgeCount"></li>
		<li id="eventCount"></li>
		<li id="diameter"></li>
	</ul>
	
</div>

	<div id="main">
		<div id="protovis">
			<script type="text/javascript+protovis">
			var startYear = 1999;
			var startMonth = 9;
			var endYear = 2010;	
			var endMonth = 8;
			

			

			
			 
			var w = 796,
    		h = 600;

    		setDateRanges(startYear, startMonth, endYear, endMonth, document.dateRanges.startDate, document.dateRanges.endDate);
    		
    	////////////////////////////////////////////
    	// define nodeFocus. True if focus is on nodes. False if on edges.
    		var nodeFocus = true;
    	
    	///////////////////////////////////////////
    	// define mouseOverEdge. True if mouse is over an edge.
    		var mouseOver = false;
		
		//////////////////////////////////////////
		// store target and source node for edge focus operations
    		var targetNodeSelect;
    		var sourceNodeSelect;
    	
    	////////////////////////////////////////////////////////
    	// store seperate target and source node info for mouse over operations.
    		var targetNodeMO;
    		var sourceNodeMO;	
    	
    	///////////////////////////////////////////////////////	
    	// define variables for colour options.
    	
    		var bgColour = "white";
    		var activeLinkOpaqueStroke = "rgba(47,79,79,1)";
    		var activeLinkStroke = "rgba(47,79,79,.5)";
    		var inactiveLinkStroke = "rgba(102,139,139,.2)";
    		var mouseoverLinkStroke = "rgba(220,20,60,1)";
    		var linkColourHolder;
    		
    		var relatedNodeFill = "rgba(0,0,255,0.7)";
    		var relatedNodeStroke = "rgba(0,0,255,0.9)";
    		
    		var inactiveNodeFill = "rgba(128,128,128,0.5)";
    		var inactiveNodeStroke = "rgba(128,128,128,0.5)";
    		
    		var focusNodeFill =	"blue";
    		var focusNodeStroke = "white";
    		
    	////////////////////////////////////////////////////////	
		// construct a 3d array of nodes and their neighbors
			var nodeNeighbors = loadNodeNeighbors();

		///////////////////////////////////////////////////////
		//fix the central node in position. This is a fix to help the stability of the system
			contributors.nodes[0].fix = new pv.Vector(w/2,h/2);

		///////////////////////////////////////////////////////
		// keep a record of the currently selected node. Assuming, on load that the currently selected node is the first in the array.
			var activeNode = 0; 
			var nodeLinkDegree = contributors.nodes[0].collaborations;

		///////////////////////////////////////////////////////
		// new panel. 
		// Essentially the base element 
		// for all protovis visualisation
			var vis = new pv.Panel()
			    .width(w)
			    .height(h)
			    .fillStyle(bgColour)
			    .event("mousedown", pv.Behavior.pan())
			    .event("mousewheel", pv.Behavior.zoom());

		///////////////////////////////////////////////////////
		//add a force layout to the Panel. 
			var force = vis.add(pv.Layout.Force)
			    .nodes(contributors.nodes)
			    .links(contributors.edges)
			    .bound(true)
			    .dragConstant(0.05)
			    .springConstant(0.05)
 			    .iterations(500)
			    .transform(pv.Transform.identity.scale(3).translate(-w/3,-h/3)) 

				;

		/////////////////////////////////////////////////////////
		//add the edges
  		   force.link.add(pv.Line) 
			    .strokeStyle(function(d, p) mouseOver && p.targetNode.index == targetNodeMO && p.sourceNode.index == sourceNodeMO ? mouseoverLinkStroke :
			    								 nodeFocus ? 
			    									p.sourceNode.index == activeNode ?
			    									 activeLinkStroke : 
		    									p.targetNode.index == activeNode ? activeLinkStroke : inactiveLinkStroke : 
		    								p.targetNode.index == targetNodeSelect && p.sourceNode.index == sourceNodeSelect ? activeLinkOpaqueStroke : inactiveLinkStroke
		    				 )
		    				 
	//	    	.event("mouseover", function(d, p) {targetNodeMO = p.targetNode.index;
	//		    									sourceNodeMO = p.sourceNode.index;
	//		    									mouseOver = true;
	//		    									return vis;
	//	    										})
		    										
	//	    	.event("mouseout", function(d,p) {mouseOver = false;
	//	    									  targetNodeMO = -1;
	//	    									  sourceNodeMO = -1;
	//	    									  return vis;
	//	    									  })

			    .event("click", function(d, p) {updateInfoWindowEdge(p);
			    								targetNodeSelect = p.targetNode.index;
			    								sourceNodeSelect = p.sourceNode.index;
			    								targetNodeMO = -1;
			    								sourceNodeMO = -1;
			    								nodeFocus=false;
			    								vis.render();})
			;
			
		//add the nodes
			force.node.add(pv.Dot)
			    .size(function(d) (d.linkDegree + 1) * Math.pow(this.scale, -1.5))
			    .fillStyle(function() nodeFocus ? 
			    					  	activeNode == this.index ? focusNodeFill : 
			    							contains(nodeNeighbors[activeNode], this.index) ? relatedNodeFill :inactiveNodeFill : 
			    						 targetNodeSelect == this.index || sourceNodeSelect == this.index ? focusNodeFill : inactiveNodeFill)

//mouseover functionality removed. can be added to the function below.
//mouseOver && this.index == targetNodeMO || this.index == sourceNodeMO ? mouseoverLink : 

			    .strokeStyle(function() 
			    						nodeFocus ? 
			    							activeNode == this.index ? focusNodeStroke : 
			    								contains(nodeNeighbors[activeNode], this.index) ? relatedNodeStroke:inactiveNodeStroke:
			    							targetNodeSelect == this.index || sourceNodeSelect == this.index ? focusNodeStroke : inactiveNodeStroke)

			    .lineWidth(2)
			  
	 		  	.event("mouseover", function(d) {targetNodeMO = d.index;
		    									mouseOver = true;
		    									return vis;})
		    	.event("mouseout", function() {mouseOver = false;
		    								   targetNodeMO = -1;
											   return vis;})
			    .event("mousedown", pv.Behavior.drag())
			    .event("drag", force)
			    .event("click", function(d) { nodeLinkDegree = d.linkDegree;
    										  activeNode = this.index;
    										  nodeFocus = true;
    										  updateInfoWindow(activeNode);
    										  return vis;})
    			.event("dblclick", function(d) alert("hoorah, this will make another call to the api, and then either reload the entire graph or append it to the existing graph."))
    			.anchor("top").add(pv.Label).text(function(d) d.nodeName)
    										.font("9pt sans-serif")
											.textStyle(	function() nodeFocus ? 
			    													activeNode == this.index ? focusNodeStroke : 
					    											contains(nodeNeighbors[activeNode], this.index) ? relatedNodeStroke:inactiveNodeStroke:
									    							targetNodeSelect == this.index || sourceNodeSelect == this.index ? focusNodeStroke : inactiveNodeStroke)
    										.textShadow("0.1em 0.1em 0.1em #333")
							    			.visible(function() mouseOver && this.index == targetNodeMO || this.index == sourceNodeMO ? true :
							    			     				nodeFocus ? activeNode == this.index?true:false:
							    								targetNodeSelect == this.index || sourceNodeSelect == this.index ? true : false)
    			;


			vis.render();
			
			$('select#startDate, select#endDate').selectToUISlider({
				labels: 12
			});

			
    </script>
<!--		<fieldset>-->
	<form name="dateRanges">
		<label for="startDate">From:</label>
		<select name="startDate" id="startDate">
		</select>
			
		<label for="endDate">To:</label>
		<select name="endDate" id="endDate">
		</select>
	</form>
<!--		</fieldset>-->


		</div>
			</div>
	<!-- include the footer -->
	

<div id="footer">

</div>

</div>
</body>
</html>
